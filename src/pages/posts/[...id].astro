---
import BaseLayout from "../../layout/BaseLayout.astro";
import { getPosts, getSlug, getTagSlug } from "../../utils/posts";
import type { CollectionEntry } from 'astro:content';
import { render } from "astro:content";
// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
  const blogEntries = await getPosts();

  const paths =  blogEntries.map(entry => ({
    params: { id: getSlug(entry) }, props: { entry },
  }));

  return paths;
}


const { entry } = Astro.props;
type Props = {
  entry: CollectionEntry<'posts'>;
};
const { Content } = await render(entry);

const slug = getSlug(entry);

const dateOptions: object = {
	year: "numeric",
	month: "long",
	day: "numeric",
};

const formattedPublishDate = new Date(entry.data.date).toLocaleDateString("en-US", dateOptions);
---
<BaseLayout pageTitle={entry.data.title} description={entry.data.description} category="blog" openGraphImage={`open-graph/${slug}.png`}>
  <h1 class="text-4xl font-bold">{entry.data.title}</h1>
  <p class="py-2 font-serif"><a class="text-blue-500 hover:underline" href="mailto:wschenk@thefocus.ai">Will Schenk</a> <span class="text-sm ">{formattedPublishDate}</span> </p>
  <ul class="py-2 flex flex-row flex-wrap gap-2">
    {entry.data.tags?.map((tag) => <li class="bg-gray-300 rounded-md px-2 py-1">#<a href={getTagSlug(tag)}>{tag}</a></li>)}
  </ul>
  <div class="prose lg:prose-xl max-w-prose font-serif">
    <Content />
    <p class="text-right py-2 font-serif"> <a class="text-blue-500 hover:underline" href="mailto:wschenk@thefocus.ai">Will Schenk</a> <span class="text-sm ">{formattedPublishDate}</span> </p>
  </div>
</BaseLayout>

<style is:global>
blockquote[data-callout] {
  padding: 1rem;
  border-radius: 1rem;
}

blockquote .callout-title {
display: flex;
}

blockquote[data-callout="error"] {
  background-color: rgb(255, 95, 122)
}

blockquote[data-callout="tip"] {
  background-color: rgb(136, 136, 220);
}

blockquote[data-callout="note"] {
  background-color: rgb(136, 220, 136);
}

blockquote p {
  font-weight: 300;

}

.prose p:first-child::first-line {
    font-variant: small-caps;
    font-size: 1.5rem;
}

.prose blockquote p:first-child::first-line {
  font-variant: normal;
  font-size: 1.2rem;
}

/* img descriptions */
img + em {
  margin-top: -2em;
  font-size: 1rem;
  line-height: 1rem;
  display: block;
}
</style>
