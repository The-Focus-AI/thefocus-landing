---
import BaseLayout from "../layout/BaseLayout.astro";
import { getrecipes, getRecipeUrl } from "../utils/recipes";
import PostListSchema from "../components/schemas/postlist.astro";
import BreadcrumbList from "../components/schemas/breadcrumb.astro";
import { formatDate } from "../utils/date";
import { getTagDisplay } from "../utils/ids";
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

const images = await import.meta.glob<{ default: ImageMetadata }>('/src/content/assets/recipes/*.{jpeg,jpg,png,gif,webp}');

const allrecipes = await getrecipes();

// Featured - most recent project
const featuredProject = allrecipes[0];

// Regular projects - next 3 most recent (excluding featured)
const regularProjects = allrecipes.slice(1, 4);

const totalProjects = allrecipes.length;
---
<BaseLayout pageTitle="Weekend Warrior Projects | Focus.AI Labs" description="Hands-on projects and experiments you can build at home" category="tools">
    <PostListSchema slot="head" posts={allrecipes} post={false}/>
    <BreadcrumbList slot="head" />

    <!-- Bell Labs Report Container -->
    <div class="max-w-7xl mx-auto bg-paper border border-void shadow-[10px_10px_0px_0px_rgba(0,0,0,0.1)] flex flex-col md:flex-row mb-12">

        <!-- Blue Binding Strip -->
        <div class="w-full md:w-20 bg-rand-blue flex md:flex-col justify-between items-center py-4 md:py-8 shrink-0 border-r border-void">
            <div class="text-white font-mono text-xs rotate-0 md:-rotate-90 whitespace-nowrap tracking-[0.3em] font-bold">
                FOCUS.AI LABS
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-8 md:p-12 relative">

            <!-- Background Pattern -->
            <div class="absolute top-0 right-0 p-8 opacity-5 pointer-events-none">
                <svg width="400" height="400" viewBox="0 0 100 100">
                    <line x1="0" y1="0" x2="100" y2="100" stroke="currentColor" stroke-width="0.5" />
                    <line x1="100" y1="0" x2="0" y2="100" stroke="currentColor" stroke-width="0.5" />
                    <circle cx="50" cy="50" r="30" fill="none" stroke="currentColor" stroke-width="0.5" />
                    <rect x="20" y="20" width="60" height="60" fill="none" stroke="currentColor" stroke-width="0.5" />
                </svg>
            </div>

            <!-- Document Header -->
            <div class="flex flex-col md:flex-row justify-between items-start mb-12 border-b-2 border-void pb-6 gap-4 relative z-10">
                <div class="font-mono text-xs space-y-1">
                    <p class="font-bold">PROJECT: Weekend Warrior Workshop</p>
                    <p>DOC. NO: WW-2025-PROJECTS</p>
                    <p class="text-gray-600">Focus.AI Labs • Est. 2024</p>
                </div>
                <div class="font-mono text-xs font-bold border border-void px-3 py-1 bg-white shadow-sm">
                    {totalProjects} PROJECTS
                </div>
            </div>

            <!-- Title Block -->
            <div class="mb-12 relative z-10">
                <h1 class="text-6xl md:text-8xl font-sans font-black text-void leading-[0.85] tracking-tight mb-8">
                    WEEKEND<br/>
                    <span class="text-rand-blue">WARRIOR</span>
                </h1>

                <p class="font-sans font-medium text-lg max-w-2xl leading-snug border-l-4 border-alert-red pl-6 py-2">
                    Hands-on projects you can build at home. Each comes with step-by-step instructions, required materials, and estimated completion time.
                </p>
            </div>

            <!-- Featured Project -->
            {featuredProject && (
                <section class="mb-12 relative z-10">
                    <div class="border-l-4 border-alert-red pl-6 py-3 bg-[#f8f8f6] mb-8">
                        <p class="font-sans font-bold text-sm uppercase tracking-wide text-gray-500 mb-1">Featured Project</p>
                        <p class="font-sans text-sm">Our top recommendation to get started</p>
                    </div>

                    <div class="border border-void bg-white mb-6 hover:bg-[#f8f8f6] transition-colors duration-200 group">
                        <div class="grid md:grid-cols-12 gap-0">
                            {featuredProject.data.image && images[`/src/content/assets/recipes/${featuredProject.data.image}`] && (
                                <div class="md:col-span-5 border-b md:border-b-0 md:border-r border-void">
                                    <div class="aspect-[4/3] md:aspect-auto md:h-full bg-surface overflow-hidden">
                                        <Image
                                            src={images[`/src/content/assets/recipes/${featuredProject.data.image}`]()}
                                            alt={featuredProject.data.title}
                                            class="w-full h-full object-cover group-hover:scale-[1.02] transition-transform duration-300"
                                        />
                                    </div>
                                </div>
                            )}
                            <div class={`${featuredProject.data.image ? 'md:col-span-7' : 'md:col-span-12'} p-6 md:p-8 flex flex-col`}>
                                <div class="mb-4">
                                    <span class="font-mono text-xs font-bold border border-void px-3 py-1 bg-rand-blue text-white">
                                        START HERE
                                    </span>
                                </div>

                                <h3 class="text-3xl md:text-4xl font-sans font-black text-void mb-4 leading-tight group-hover:text-rand-blue transition-colors duration-200">
                                    <a href={getRecipeUrl(featuredProject)}>
                                        {featuredProject.data.title}
                                    </a>
                                </h3>

                                <p class="text-base text-void/80 leading-relaxed mb-6 flex-grow">
                                    {featuredProject.data.description}
                                </p>

                                <a href={getRecipeUrl(featuredProject)} class="block w-full text-center px-4 py-3 bg-rand-blue text-white font-bold uppercase text-[10px] tracking-[0.3em] hover:bg-opacity-90 transition-opacity duration-200 font-mono">
                                    Start This Build →
                                </a>
                            </div>
                        </div>
                    </div>
                </section>
            )}

            <!-- Quick Build Preview -->
            {regularProjects.length > 0 && (
                <section class="relative z-10">
                    <div class="border-l-4 border-alert-red pl-6 py-3 bg-[#f8f8f6] mb-8">
                        <p class="font-sans font-bold text-sm uppercase tracking-wide text-gray-500 mb-1">More Projects</p>
                        <p class="font-sans text-sm">Quick builds for a productive afternoon</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-px bg-void border border-void">
                        {regularProjects.map((recipe, index) => (
                            <div class="bg-white hover:bg-[#f8f8f6] transition-colors duration-200 flex flex-col group">
                                {recipe.data.image && images[`/src/content/assets/recipes/${recipe.data.image}`] && (
                                    <div class="aspect-[16/9] bg-surface overflow-hidden border-b border-void">
                                        <Image
                                            src={images[`/src/content/assets/recipes/${recipe.data.image}`]()}
                                            alt={recipe.data.title}
                                            class="w-full h-full object-cover group-hover:scale-[1.02] transition-transform duration-300"
                                        />
                                    </div>
                                )}
                                <div class="p-6 flex flex-col flex-grow">
                                    <div class="mb-3">
                                        <span class="text-alert-red font-mono text-[10px] font-bold">
                                            {formatDate(recipe.data.date)}
                                        </span>
                                    </div>
                                    <h4 class="text-xl font-sans font-black text-void mb-3 leading-tight group-hover:text-rand-blue transition-colors duration-200">
                                        <a href={getRecipeUrl(recipe)}>
                                            {recipe.data.title}
                                        </a>
                                    </h4>
                                    <p class="text-sm text-void/70 leading-relaxed mb-4 flex-grow">
                                        {recipe.data.description}
                                    </p>
                                    <a href={getRecipeUrl(recipe)} class="block w-full text-center px-4 py-2 bg-rand-blue text-white font-bold uppercase text-[10px] tracking-[0.3em] hover:bg-opacity-90 transition-opacity duration-200 font-mono mt-auto">
                                        View →
                                    </a>
                                </div>
                            </div>
                        ))}
                    </div>
                </section>
            )}

            <!-- Browse All CTA -->
            <div class="mt-12 relative z-10">
                <div class="border border-void bg-[#f8f8f6] p-8 text-center">
                    <p class="font-mono text-sm text-void/70 mb-4">
                        Showing {regularProjects.length + 1} of {totalProjects} projects
                    </p>
                    <a href="/tools/browse" class="inline-block px-8 py-4 bg-rand-blue text-white font-bold uppercase text-xs tracking-[0.3em] hover:bg-opacity-90 transition-opacity duration-200 font-mono">
                        Browse All {totalProjects} Projects →
                    </a>
                </div>
            </div>

            <!-- Footer Notice -->
            <div class="mt-16 pt-8 border-t border-void relative z-10">
                <div class="font-mono text-xs text-center">
                    <p class="font-bold uppercase tracking-[0.3em] text-rand-blue mb-2">
                        Focus.AI Labs Workshop Series
                    </p>
                    <p class="text-void/70 uppercase tracking-wider">
                        New projects added regularly
                    </p>
                </div>
            </div>

        </div>
    </div>

</BaseLayout>
