---
import BaseLayout from "../../layout/BaseLayout.astro";
import { getCollection } from "astro:content";
import { render } from "astro:content";
import { formatDate } from "../../utils/date";
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  let jobs = await getCollection("jobs");

  if (import.meta.env.NODE_ENV !== "development") {
    jobs = jobs.filter((job) => job.data.published);
  }

  return jobs.map(entry => ({
    params: { id: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;
type Props = {
  entry: CollectionEntry<'jobs'>;
};
const { Content } = await render(entry);
---

<BaseLayout pageTitle={`${entry.data.title} | Focus.AI Careers`} description={`${entry.data.type} · ${entry.data.location}${entry.data.rate ? ` · ${entry.data.rate}` : ''}`} openGraphImage={entry.data.ogImage || "og-jobs.png"} category="jobs">

    <div class="max-w-4xl mx-auto">
        <!-- Back Link -->
        <div class="mb-6">
            <a href="/jobs" class="text-xs uppercase tracking-[0.15em] text-rand-blue hover:underline font-mono font-bold">
                ← Back to All Positions
            </a>
        </div>

        <!-- Job Header -->
        <div class="bg-[#f8f8f6] border-l-4 border-rand-blue p-6 md:p-8 mb-8 font-mono text-sm border border-void">
            <div class="grid grid-cols-[100px_1fr] md:grid-cols-[120px_1fr] gap-2 mb-4">
                <div class="text-gray-500 uppercase tracking-wider font-bold">Position:</div>
                <div class="text-void font-medium">{entry.data.title}</div>

                <div class="text-gray-500 uppercase tracking-wider font-bold">Type:</div>
                <div class="text-void font-medium">{entry.data.type}</div>

                <div class="text-gray-500 uppercase tracking-wider font-bold">Location:</div>
                <div class="text-void">{entry.data.location}</div>

                {entry.data.hours && (
                    <>
                        <div class="text-gray-500 uppercase tracking-wider font-bold">Hours:</div>
                        <div class="text-void">{entry.data.hours}</div>
                    </>
                )}

                {entry.data.rate && (
                    <>
                        <div class="text-gray-500 uppercase tracking-wider font-bold">Rate:</div>
                        <div class="text-void font-medium">{entry.data.rate}</div>
                    </>
                )}

                <div class="text-gray-500 uppercase tracking-wider font-bold">Posted:</div>
                <div class="text-void">{formatDate(entry.data.date)}</div>
            </div>
            <div class="pt-4 border-t border-void/20 flex justify-between items-center">
                <div class="text-[10px] uppercase tracking-[0.2em] text-gray-500">
                    Focus.AI • Est. 2024
                </div>
                <div class="font-mono text-[10px] font-bold border border-void px-2 py-1 bg-white text-petrol">
                    OPEN POSITION
                </div>
            </div>
        </div>

        <!-- Job Title -->
        <h1 class="text-4xl md:text-6xl font-sans font-black text-void mb-8 leading-tight">
            {entry.data.title}
        </h1>

        <!-- Job Content -->
        <div class="prose lg:prose-xl max-w-none">
            <Content />
        </div>

        <!-- Apply CTA -->
        <div class="mt-12 pt-8 border-t-2 border-void">
            <div class="bg-rand-blue text-white p-6 md:p-8">
                <h2 class="text-2xl font-black mb-4">Interested?</h2>
                <p class="text-white/90 mb-6">
                    We'd love to hear from you. Apply using the instructions above, or reach out if you have any questions.
                </p>
                <a href="mailto:hey@thefocus.ai" class="inline-block px-6 py-3 bg-white text-rand-blue font-bold uppercase text-sm tracking-wider hover:bg-white/90 transition-colors">
                    Apply Now →
                </a>
            </div>
        </div>

        <!-- Back Link -->
        <div class="mt-8">
            <a href="/jobs" class="block w-full text-center px-4 py-3 border-2 border-void text-void font-bold uppercase text-xs tracking-[0.2em] hover:bg-void hover:text-paper transition-colors duration-200 font-mono">
                ← View All Positions
            </a>
        </div>
    </div>

</BaseLayout>
